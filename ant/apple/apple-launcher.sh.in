#!/bin/bash
##########################################################################################
#                                  ${project.name} MacOS Launcher                                #
##########################################################################################
#  Description:                                                                          #
#    1. Searches for Java                                                                #
#    2. Launches ${project.name} with the best Java version                              #
#                                                                                        #
#  Depends:                                                                              #
#    java                                                                                #
#                                                                                        #
#  Usage:                                                                                #
#    $ ./${project.name}                                                                 #
##########################################################################################

# Build absolute path to the jar file, based relative to the location of this script
installpath=$(echo "$0" | rev | cut -d/ -f4- | rev)
jarpath=$installpath/${project.filename}.jar
iconpath=$installpath/${apple.resources}/${apple.icon}
localautostart="${apple.datadir.local}/${autostart.name}"
globalautostart="${apple.datadir.shared}/${autostart.name}"
${apple.jvmver} > /dev/null 2>&1
fallback=$?

# If launched at startup, check override first
if [ "$1" = "-A" ]
then
    if [ -f "$localAutostart" ];
    then
        if [ "$(head -n 1 $localautostart)" = "0" ]
        then
           echo "Skipping autostart"
           exit 0
        fi
    else
        if [ -f "$globalautostart" ];
        then
            if [ "$(head -n 1 $globalautostart)" = "0" ]
            then
                echo "Skipping autostart"
                exit 0
            fi
        fi
    fi
fi

# Fallback on Internet Plug-Ins version if needed
if [ $fallback -eq 0 ]; then
	${apple.jvmcmd} java ${launch.opts} -Xdock:name="${project.name}" -Xdock:icon="$iconpath" -jar "$jarpath"
else
	"${apple.jvmfallback}/java" ${launch.opts} -Xdock:name="${project.name}" -Xdock:icon="$iconpath" -jar "$jarpath"
fi

exit $?
